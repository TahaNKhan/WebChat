<!DOCTYPE html>
<html>

<head>
    <% include ./partials/content/header %>
        <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
</head>

<body>
    <div class="container">
        <% include ./partials/template/navbar.ejs %>

            <p>Welcome!
                <%=user.username%>
            </p>
            <p></p>
            <div class="row">
                <div class="col-sm-12">
                    <div id="messages">
                        <textarea class="form-control"></textarea>
                    </div>
                </div>
            </div>
            <div class="row" id="sendmessage">
                <div class="col-sm-8">
                    <input id="thismessage" onchange="sendThroughEnter()" placeholder="Enter a Message Here" class="form-control">
                </div>
                <div class="col-sm-4">
                    <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                </div>



            </div>
    </div>
</body>
<script>
    $(document).ready(function () {
        setInterval(function () {
            //code goes here that will be run every 1 seconds.   
            $("#messages").load('/messages');
        }, 1000);
    });
</script>
<script>
    sendMessage = function () {

        $.ajax({
            url: '/messages/send/' + $("#thismessage").val(),
            type: 'PUT',

            success: function (data) {
                console.log('happened')
            }
        });
        $("#thismessage").val('');
    }
</script>
<script>
    sendThroughEnter = function () {
        $("#thismessage").keyup(function (e) {
            /*
             * Delay the enter key form submit till after the hidden
             * input is updated.
             */

            // No need to do anything if it's not the enter key
            // Also only e.which is needed as this is the jQuery event object.
            if (e.which !== 13) {
                return;
            } else {

                // Prevent form submit
                e.preventDefault();

                sendMessage();


            }
        });
    }
</script>

</html>